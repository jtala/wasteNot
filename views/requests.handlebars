<style>
  .loader {
  border: 16px solid #f3f3f3;
  border-top: 16px solid #3498db; 
  border-radius: 50%;
  width: 120px;
  height: 120px;
  animation: spin 2s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>
<button onclick="window.location.href = '/';">Home</button>
<br>
<br>
<div class="welcome">
{{!--     Username here when ready --}}    
    <h2>Recycling Service in the next 10 minutes.</h2>
    <div id="instructions">
    <p> Lorem ipsum dolor sit amet consectetur adipisicing elit. Molestias illum nesciunt eos quas deserunt aliquid, officia doloremque corporis esse neque. Nesciunt sequi ipsam ratione possimus temporibus minus officia dolorem nobis.</p>
     <br><br>
    </div>
</div>

<form id="cms">
    <div class="form-group">
        <br />
        <label for="item_name">Item Name</label>
        <input placeholder="Recyclables" type="text" class="form-control" id="item_name">
        <br />
        <label for="estimated_weight">Estimated Weight (lbs): </label>
        <input placeholder="15 lbs" type="text" class="form-control" id="estimated_weight">
        <br />
        <label for="item_location">Item Location: </label>
        <input placeholder="Los Angeles" type="text" class="form-control" id="item_location">

        <br/>
        <button type="submit" id="submit" class="submit tile">Submit</button>
    </div>
</form>

<br><br>

<div id="currentRequests">
    <h2>Requests On The Way</h2>

    <table>
        <tr>
            <th>Customer Name</th>
            <th>Customer Location</th>
            <th>Item</th>
            <th>Estimated Weight</th>
            <th>Request Status</th>
        </tr>
        {{#each requests}}
        {{#unless is_complete}}
        <tr>
            <td>{{this.customer}}</td>
            <td>{{this.location}}</td>
            <td>{{this.item}}</td>
            <td>{{this.weight}}</td>
            <td>
              {{#if this.status}}
                <p>Accepted</p>
                {{else}}
                <p>Not yet accepted</p>
                {{/if}}
            </td>
            {{#unless this.is_complete}}
            <td>
                <button class="cancel-btn" id={{this.id}} >Cancel Request</button>
            </td>
            {{/unless}}
        </tr>
        {{/unless}}
        {{/each}}
    </table>

    <h2>Canceled Requests</h2>
    <table>
        <tr>
            <th>Customer Name</th>
            <th>Customer Location</th>
            <th>Item</th>
            <th>Estimated Weight</th>
            <th>Request Status</th>
        </tr>
        {{#each requests}}
        {{#if is_complete}}
        <tr>
            <td>{{this.customer}}</td>
            <td>{{this.location}}</td>
            <td>{{this.item}}</td>
            <td>{{this.weight}}</td>
            <td>
              {{#if this.status}}
                <p>Accepted</p>
                {{else}}
                <p>Not yet accepted</p>
                {{/if}}
            </td>
        </tr>
        {{/if}}
        {{/each}}
    </table>
</div>



<script>
 $(document).ready(function() {

 
var cItemName = $("#item_name");
var cEstWeight = $("#estimated_weight");
var cItemLocation = $("#item_location");
var cmsForm = $("#cms");


// On click listener for when customer submits form.
$("#submit").on("click", handleFormSubmit);

// Function prevents empty slots, creates an object with customer's data & posts it to the backend. Can be seen in the requests db.
function handleFormSubmit(event) {
    event.preventDefault();
    // Will not submit unless every field has data.
    if (!cItemName.val().trim() || !cEstWeight.val() || !cItemLocation.val() ) {
      return;
    }
    // Take data from form & make a new object for database to read.
    var newCustomer = {
      item: cItemName.val().trim(),
      weight: cEstWeight.val().trim(),
      location: cItemLocation.val().trim()
    };

    console.log(newCustomer);

    // Sending to the backend.
    submitCustomer(newCustomer);
  }

function submitCustomer (post){
  var request_id = $(this).attr("id");
    $.ajax({
      method: "POST",
      url: "/api/request/" + request_id
    }).then(function (data) {
      console.log(data);
    });
});
}
});
</script>